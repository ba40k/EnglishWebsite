{% extends "base.html" %}

{% block title %}Test Results - English Learning Platform{% endblock %}

{% block content %}
<div class="content-card">
  <h1>📊 Test Results</h1>

  <div class="score-display">
    <h2>Your Score</h2>
    <div class="score-percentage">
      {{ (score.correct * 100 / score.total) | round(1) }}%
    </div>
    <p style="font-size: 1.5rem; margin: 0;">
      {{ score.correct }} out of {{ score.total }} correct
    </p>
  </div>

  {% if results and ai_explanations %}
  <div style="margin-top: 3rem;">
    <h2>📝 Detailed Review</h2>
    <p style="color: var(--gray); margin-bottom: 2rem;">Learn from your answers with AI-powered explanations!</p>
    
    {% for i in range(results|length) %}
    <div class="test-result {% if results[i].is_correct %}correct{% else %}incorrect{% endif %}">
      <h3 style="color: var(--dark); margin-bottom: 1rem;">
        Question {{ i + 1 }}: {{ results[i].question }}
      </h3>
      
      <div style="margin: 1rem 0;">
        <p style="margin: 0.5rem 0;">
          <strong>Your Answer:</strong> 
          <span style="{% if results[i].is_correct %}color: var(--success);{% else %}color: var(--danger);{% endif %}">
            {{ results[i].user_answer }}
          </span>
        </p>
        
        {% if not results[i].is_correct %}
        <p style="margin: 0.5rem 0;">
          <strong>Correct Answer:</strong> 
          <span style="color: var(--success);">{{ results[i].correct_answer }}</span>
        </p>
        {% endif %}
        
        <p style="margin: 0.5rem 0;">
          <strong>Result:</strong> 
          {% if results[i].is_correct %}
            <span style="color: var(--success); font-weight: 600;">✅ Correct!</span>
          {% else %}
            <span style="color: var(--danger); font-weight: 600;">❌ Incorrect</span>
          {% endif %}
        </p>
      </div>
      
      {% if ai_explanations and i < ai_explanations|length %}
      <div style="background-color: var(--white); padding: 1rem; margin-top: 1rem; border-radius: 8px; border: 2px solid rgba(102, 126, 234, 0.2);">
        <strong style="color: var(--primary);">🤖 AI Explanation:</strong>
        <p style="margin-top: 0.5rem; line-height: 1.7; color: var(--dark);">{{ ai_explanations[i] }}</p>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <div style="margin-top: 3rem; text-align: center; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
    <a href="/tests/{{ test.id }}" class="btn">🔄 Retake Test</a>
    <a href="/tests" class="btn btn-outline">📚 Back to Tests</a>
  </div>
</div>
{% endblock %}